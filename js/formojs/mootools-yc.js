if(typeof FormoJS=="undefined"){FormoJS={}}FormoJS.Form=new Class({element:null,fields:[],initialize:function(a){this.element=a;a.getElements("input[type!=submit]").each(function(c){var b=new FormoJS.Field(c,this);this.fields.push(b);c.addEvent("change",this.field_blurred.bindWithEvent(this,[c,b]));c.addEvent("keypress",this.field_keypress.bindWithEvent(this,[c,b]))},this)},keypress_timer:null,field_blurred:function(b,c,a){if(this.keypress_timer!=null){$clear(this.keypress_timer)}a.validate()},field_keypress:function(b,c,a){if(this.keypress_timer!=null){$clear(this.keypress_timer)}this.keypress_timer=(function(){a.validate()}).delay(1500)}});FormoJS.Field=new Class({element:null,form:null,request:null,data:null,initialize:function(a,b){this.element=a;this.form=b},get_block:function(){return this.element.getParent().getParent().getParent()},validate:function(){var c=this.get_block();var a=this;var b="field="+this.element.name+"&value="+this.element.value;if(b==this.data){return}if(this.request!=null){this.request.cancel()}this.data=b;this.request=new Request.JSON({url:FormoJS.validate_url+"field",data:b,onRequest:function(){c.removeClass("valid");c.removeClass("error");c.removeClass("server_error");c.addClass("validating")},onComplete:function(){c.removeClass("validating");a.request=null},onFailure:function(){c.addClass("server_error");a.set_message(this.xhr.responseText)},onSuccess:function(e,d){if(e.status=="valid"){c.addClass("valid")}else{if(e.status=="invalid"){c.addClass("error")}else{c.addClass("server_error")}}a.set_message(e.message)}});this.request.setHeader("Referer",String(document.location));this.request.send()},set_message:function(a){this.get_block().getElement(".error-message").set("html",a)}});window.addEvent("domready",function(){if(typeof FormoJS.validate_url=="undefined"){if(typeof console!="undefined"){console.log("Validation URL not configured.")}return}$$(".formo_form").each(function(a){new FormoJS.Form(a)})});